services:
  # 1. Ana Uygulama (Web Servisi)
  - type: web
    name: librechat
    env: docker
    repo: https://github.com/keremsaltik/librechat-render-deployment # Repoyu belirtmek iyidir
    region: frankfurt # Frankfurt (Almanya) sunucusunu seçelim
    plan: free # Ücretsiz planla başlayalım
    image:
      url: docker.io/keremle/librechat:v0.8.1
    healthCheckPath: /
    envVars:
      - key: PORT
        value: 3080
      - key: HOST
        value: 0.0.0.0
      - fromGroup: librechat-secrets # Tüm şifreleri tek bir gruptan çekeceğiz

  # 2. MongoDB (Özel Servis)
  - type: pserv
    name: mongodb
    env: docker
    region: frankfurt
    plan: free
    image:
      url: docker.io/keremle/mongo-librechat:latest
    disk:
      name: mongo-data
      mountPath: /data/db
      sizeGB: 1

  # 3. RAG API (Özel Servis)
  - type: pserv
    name: ragapi
    env: docker
    region: frankfurt
    plan: free
    image:
      url: docker.io/keremle/librechat-rag-api:latest
    envVars:
      - fromGroup: librechat-secrets

  # 4. MeiliSearch (Özel Servis)
  - type: pserv
    name: meilisearch
    env: docker
    region: frankfurt
    plan: free
    image:
      url: docker.io/keremle/meilisearch-librechat:v1.12.3
    disk:
      name: meili-data
      mountPath: /meili_data
      sizeGB: 1
    envVars:
      - fromGroup: librechat-secrets

  # 5. VectorDB (Özel Servis)
  - type: pserv
    name: vectordb
    env: docker
    region: frankfurt
    plan: free
    image:
      url: docker.io/keremle/pgvector-librechat:latest
    disk:
      name: pg-data
      mountPath: /var/lib/postgresql/data
      sizeGB: 1
    envVars:
      - key: POSTGRES_USER
        value: librechat
      - key: POSTGRES_DB
        value: librechat_db
      - key: POSTGRES_PASSWORD
        generateValue: true # Şifreyi Render kendi oluştursun

# Tüm gizli bilgileri toplayacağımız grup
envVarGroups:
  - name: librechat-secrets
    envVars:
      - key: MONGO_URI
        value: mongodb://mongodb:27017/LibreChat
      - key: RAG_API_URL
        value: http://ragapi:8000
      - key: MEILI_HOST
        value: http://meilisearch:7700
      - key: OPENAI_API_KEY
        sync: false
      - key: GOOGLE_SEARCH_API_KEY
        sync: false
      - key: GOOGLE_CSE_ID
        sync: false
      - key: JWT_SECRET
        sync: false
      # ... .env dosyasındaki diğer tüm anahtarlar buraya "sync: false" ile eklenecek