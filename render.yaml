services:
  # 1. Ana Uygulama (Web Servisi)
  - type: web
    name: librechat
    env: docker
    region: frankfurt
    plan: starter # Ücretli plan (Disk için şart)
    image:
      url: docker.io/keremle/librechat:v0.8.1
    healthCheckPath: /
    envVars:
      - key: HOST
        value: 0.0.0.0
      - key: PORT
        value: 3080
      # --- DÜZELTİLMİŞ BAĞLANTILAR ---
      - key: MONGO_URI
        value: mongodb://${mongodb.host}:${mongodb.port}/LibreChat
      - key: RAG_API_URL
        value: http://${ragapi.host}:${ragapi.port}
      - key: MEILI_HOST
        value: http://${meilisearch.host}:${meilisearch.port}
      # --- GİZLİ BİLGİLER ---
      - fromGroup: librechat-secrets

  # 2. MongoDB Veritabanı
  - type: pserv
    name: mongodb
    env: docker
    region: frankfurt
    plan: starter # Ücretli plan
    image:
      url: docker.io/keremle/mongo-librechat:latest
    disk:
      name: mongo-data
      mountPath: /data/db
      sizeGB: 1

  # 3. RAG API
  - type: pserv
    name: ragapi # İsimleri basitleştirdim
    env: docker
    region: frankfurt
    plan: starter # Ücretli plan
    image:
      url: docker.io/keremle/librechat-rag-api:latest
    envVars:
      - fromGroup: librechat-secrets

  # 4. MeiliSearch
  - type: pserv
    name: meilisearch
    env: docker
    region: frankfurt
    plan: starter # Ücretli plan
    image:
      url: docker.io/keremle/meilisearch-librechat:v1.12.3
    disk:
      name: meili-data
      mountPath: /meili_data
      sizeGB: 1
    envVars:
      - fromGroup: librechat-secrets

  # 5. VectorDB
  - type: pserv
    name: vectordb
    env: docker
    region: frankfurt
    plan: starter # Ücretli plan
    image:
      url: docker.io/keremle/pgvector-librechat:latest
    disk:
      name: pg-data
      mountPath: /var/lib/postgresql/data
      sizeGB: 1
    envVars:
      - key: POSTGRES_USER
        value: librechat
      - key: POSTGRES_DB
        value: librechat_db
      - key: POSTGRES_PASSWORD
        generateValue: true

# Tüm gizli bilgileri toplayacağımız grup
envVarGroups:
  - name: librechat-secrets
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: GOOGLE_SEARCH_API_KEY
        sync: false
      # ... .env dosyasındaki diğer tüm anahtarlar buraya "sync: false" ile eklenecek