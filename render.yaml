services:
  # 1. Ana Uygulama (Web Servisi)
  - type: web
    name: librechat
    env: docker
    region: frankfurt
    plan: starter
    image:
      url: docker.io/keremle/librechat:v0.8.1
    healthCheckPath: /
    envVars:
      - key: HOST
        value: 0.0.0.0
      - key: PORT
        value: 3080
      - fromGroup: librechat-secrets

  # 2. MongoDB
  - type: pserv
    name: mongodb
    env: docker
    region: frankfurt
    plan: starter
    image:
      url: docker.io/keremle/mongo-librechat:latest
    disk:
      name: mongo-data
      mountPath: /data/db
      sizeGB: 1

  # 3. RAG API
  - type: pserv
    name: ragapi
    env: docker
    region: frankfurt
    plan: starter
    image:
      url: docker.io/keremle/librechat-rag-api:latest
    envVars:
      - fromGroup: librechat-secrets

  # 4. MeiliSearch
  - type: pserv
    name: meilisearch
    env: docker
    region: frankfurt
    plan: starter
    image:
      url: docker.io/keremle/meilisearch-librechat:v1.12.3
    disk:
      name: meili-data
      mountPath: /meili_data
      sizeGB: 1
    envVars:
      - fromGroup: librechat-secrets

  # 5. VectorDB
  - type: pserv
    name: vectordb
    env: docker
    region: frankfurt
    plan: starter
    image:
      url: docker.io/keremle/pgvector-librechat:latest
    disk:
      name: pg-data
      mountPath: /var/lib/postgresql/data
      sizeGB: 1
    envVars:
      - key: POSTGRES_USER
        value: librechat
      - key: POSTGRES_DB
        value: librechat_db
      - key: POSTGRES_PASSWORD
        generateValue: true

# --- İŞTE BÜTÜN SİHİR BURADA ---
envVarGroups:
  - name: librechat-secrets
    envVars:
      # Bağlantılar
      - key: MONGO_URI
        value: mongodb://mongodb:27017/LibreChat
      - key: RAG_API_URL
        value: http://ragapi:8000
      - key: MEILI_HOST
        value: http://meilisearch:7700
      - key: DB_HOST # RAG API için
        value: vectordb

      # Gizli Anahtarlar (Bunları Render'da elle gireceksin)
      - key: OPENAI_API_KEY
        sync: false
      - key: GOOGLE_SEARCH_API_KEY
        sync: false
      - key: GOOGLE_CSE_ID
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: JWT_REFRESH_SECRET
        sync: false
      - key: MEILI_MASTER_KEY
        sync: false
      - key: RAG_API_KEY
        sync: false
      - key: RAG_OPENAI_API_KEY
        sync: false
      
      # Diğer .env Ayarları
      - key: SEARCH_PROVIDER
        value: google
      - key: ENDPOINTS
        value: "openAI,assistants"
      - key: ALLOW_PLUGINS # v0.8.1'de bu hala gerekli olabilir
        value: "true"